service: fotopia-client

frameworkVersion: ">=1.1.0 <2.0.0"

plugins:
  - serverless-offline
  - serverless-s3-sync
  - serverless-s3-local
  - serverless-s3-local-sync
  - serverless-s3-remover

custom:
  serverless-offline:
    port: 3001
  s3:
    host: 0.0.0.0
    port: 5002
    directory: /tmp/s3bucket
    cors: false
    # noStart: true
  s3Sync:
    - bucketName: ${self:provider.environment.S3_CLIENT_BUCKET}
      localDir: build
  remover:
     buckets:
       - ${self:provider.environment.S3_CLIENT_BUCKET}

provider:
  name: aws
  runtime: nodejs6.10
  stage: prod
  region: us-east-1
  profile: default
  environment:
    S3_CLIENT_BUCKET: ${self:service}-${opt:stage, self:provider.stage}-client
   
resources:
  Resources:
    FotopiaClientBucket:
      Type: AWS::S3::Bucket
      DeletionPolicy: Delete
      Properties:
        BucketName: ${self:provider.environment.S3_CLIENT_BUCKET}
        AccessControl: PublicRead
        WebsiteConfiguration:
           IndexDocument: index.html
           ErrorDocument: index.html
